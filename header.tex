% Language & Fonts
\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage{inconsolata}
\DeclareUnicodeCharacter{2264}{-} % Compilation issue
\DeclareUnicodeCharacter{0307}{-} % Compilation issue
\DeclareUnicodeCharacter{2212}{-} % Compilation issue

% Set page margin
\usepackage[margin=1in]{geometry} % , total={18cm, 26cm}, inner=2.6cm, outer=1.8cm, top=2.5cm, bottom=3.5cm 

% Bibliography libraries
\usepackage[
backend=bibtex,
style=plainurl,
style=numeric-comp,
sorting=none,
eprint=false,
url=false,
% isbn=false,
firstinits=true,
]{biblatex}

% Supress In for articles
\renewbibmacro{in:}{%
  \ifentrytype{article}{}{\printtext{\bibstring{in}\intitlepunct}}}
  
% Remove number and arxivid for articles
\AtEveryBibitem{
\ifentrytype{article}{
    \clearfield{number}
    \clearfield{arxivid}
    \clearfield{isbn}
    \clearfield{issn}
}{}
\ifentrytype{book}{
    \clearfield{pages}
}{}
}

% Give the bibliography a "raggedright"
\renewcommand*{\bibfont}{\raggedright}

\addbibresource{bibliography/topic1.bib}
% Add more bib resources here!

% Math stuff
\usepackage{mathtools}
\usepackage{textcomp}
\usepackage{braket}
\usepackage{sansmath}

\usepackage{paralist}
\usepackage{enumerate}
\usepackage{parskip}
\usepackage{microtype}
\usepackage[section]{placeins}
\usepackage{gensymb}
\usepackage[pdftex]{graphicx}

% Colors
\usepackage{xcolor}
\usepackage{soul}


% Various
\usepackage{epigraph} % Cool quotes at the beginning of each chapter
\usepackage[version=4]{mhchem} % Pretty chemical formulae
\usepackage{siunitx} % Pretty SI units
\usepackage[textsize=small]{todonotes} % Add todo's to the text
\usepackage{changepage} % Make local changes to page layout, e.g. wider margins
\usepackage{afterpage} % Make empty pages
\usepackage{pdfcomment}
\usepackage{lipsum}
\usepackage{qrcode} % Generate QR codes for jupyter links in print version.

\usepackage{amsmath,amssymb}
\usepackage{dcolumn}
\usepackage{bm}
\usepackage[none]{hyphenat}
\usepackage{flafter}
\usepackage{lipsum}

% Table options
\usepackage{dcolumn}% Align table columns on decimal point
\usepackage{booktabs}
\usepackage[font=sf]{floatrow}
\floatsetup[table]{capposition=top}
\usepackage[font=sf]{caption}
\usepackage[bottom]{footmisc}
\usepackage{multirow}

% \usepackage{float}

\usepackage{rotating}
\usepackage{subcaption}
\usepackage{wrapfig}
\usepackage{mdframed}

\usepackage[toc, page]{appendix}
\usepackage{blindtext}

% Fancy headers for the pages
\usepackage{fancyhdr}
\fancypagestyle{chapter}{
\fancyhf{}
\renewcommand{\headrulewidth}{0.4pt}
\fancyhead[R]{\ifthenelse{\isodd{\value{page}}}{\textsl{\rightmark}}{}}
\fancyfoot[R]{\ifthenelse{\isodd{\value{page}}}{\thepage}{}}
\fancyhead[L]{\ifthenelse{\isodd{\value{page}}}{}{\textsl{\leftmark}}}
\fancyfoot[L]{\ifthenelse{\isodd{\value{page}}}{}{\thepage}}
}

\fancypagestyle{plain}{
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}
\fancyfoot[R]{\ifthenelse{\isodd{\value{page}}}{\thepage}{}}
}

\fancypagestyle{biblio}{
\fancyhf{}
\renewcommand{\headrulewidth}{0.4pt}
\fancyfoot[R]{\ifthenelse{\isodd{\value{page}}}{\thepage}{}}
\fancyfoot[L]{\ifthenelse{\isodd{\value{page}}}{}{\thepage}}
}

% Chapter header formatting
\usepackage{titlesec}
\titleformat{\chapter}[display]
{\normalfont\huge\bfseries}{\chaptertitlename~\thechapter}{20pt}{\Huge}
\titlespacing*{\chapter}{0pt}{50pt}{40pt}
\titlespacing*{name=\chapter,numberless}{0pt}{-30pt}{10pt}

% Paragraph formatting
\expandafter\def\expandafter\normalsize\expandafter{%
    \normalsize
    \setlength\abovedisplayskip{15pt}
    \setlength\belowdisplayskip{15pt}
    \setlength\abovedisplayshortskip{15pt}
    \setlength\belowdisplayshortskip{15pt}
}

\setlength{\intextsep}{25pt}

\hyphenpenalty 750
\interfootnotelinepenalty=10000 % Never break footnotes
\clubpenalties 6 10000 8000 5000 4000 3000 0 % Very strict setting for breaking paragraphs from the top
\widowpenalties 6 10000 8000 5000 4000 3000 0 % Very strict setting for breaking paragraphs from the bottom
\raggedbottom

%%%%%%%% TikZ Settings %%%%%%%%%

\usepackage{tikz}
\usetikzlibrary{arrows, positioning, fit, backgrounds, calc, shapes}

\usepackage{pgfplots}
\pgfplotsset{compat=newest}
\usepgfplotslibrary{groupplots}
\usepgfplotslibrary{dateplot}

%% General %%

% Define a maximum node width
\usepackage{varwidth}
\tikzset{
    max width/.style args={#1}{
        execute at begin node={\begin{varwidth}{#1}},
        execute at end node={\end{varwidth}}
    }
}

\newcommand{\nodecaption}[2]{\subcaptionbox{#1\label{#2}}{\phantom{(X)~#1}}}

\tikzset{my lines/.style={ 
    black!30!white, line width = 0.2pt 
}}

%% DFT %%
 
\definecolor{helpcolor}{HTML}{63AABC} 

\tikzstyle{box} = [draw, rounded corners, very thick, align=center, inner 
sep=1em, execute at begin node=\setlength{\baselineskip}{2em}] 
\tikzstyle{arrow} = [>=latex, very thick] 
\tikzstyle{helpline} = [color=helpcolor, very thick] 
\tikzstyle{helpbox} = [fill, rounded corners, text width=12.5em, 
fill=helpcolor, fill opacity=0.5, text opacity=1, font=\small] 

%% Automation %%

\definecolor{fwcolor}{HTML}{63AABC}
\definecolor{ftcolor}{HTML}{F9F3EC}
\definecolor{wf_helpcolor}{HTML}{ED7833}
\definecolor{conditionboxbg}{HTML}{FFFFFF}

\tikzstyle{firework_name} = [font=\bf\ttfamily]
\tikzstyle{firework} = [fill=fwcolor, rounded corners, very thick, fill opacity=1]
\tikzstyle{firetask} = [draw, rectangle, rounded corners, minimum height=1.5em, minimum width=5em, anchor=west, font=\footnotesize\ttfamily, thick, fill=ftcolor]
\tikzstyle{firearrow} = [>=latex, very thick, dashed]
\tikzstyle{wf-helpline} = [color=wf_helpcolor, very thick]
\tikzstyle{wf-helpbox} = [fill, rounded corners, text width=12.5em, fill=wf_helpcolor, fill opacity=0.5, text opacity=1, font=\small]
\tikzstyle{conditionbox} = [fill=conditionboxbg, rounded corners, fill opacity=0.6, text opacity=1, font=\footnotesize]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \definecolor{link}{RGB}{137, 5, 47}
\definecolor{link}{RGB}{0, 0, 0}

% Links
\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    citecolor=black,
    linkcolor=black,
    filecolor=magenta,      
%     urlcolor=blue,
    urlcolor=black,
}

%%%%% Commands %%%%%

\usepackage{ifthen}
\usepackage{xstring}

% New command for less cramped fractions.
\newcommand\ddfrac[2]{\frac{\displaystyle #1}{\displaystyle #2}}

% Quick command for a very visible TODO that shows that a citation is needed.
\newcommand{\tocite}{\todo[inline]{Citation Needed}}

% Commands for code, links
\definecolor{hlcolor}{gray}{.90}
\sethlcolor{hlcolor}

\newcommand{\code}[1] {\texttt{\hl{#1}}}
\newcommand{\link}[2] {\hyperref[#1]{\textcolor{link}{#2}}}
\newcommand{\firetask}[1] {\hyperref[automation:sec-#1]{\textcolor{black}{\texttt{#1}}}}
\newcommand{\vasp}[1] {\hyperref[appendix:sec-#1]{\textcolor{link}{\texttt{#1}}}}
 
% Commands for fancy section headers with symbols that links to Jupyter notebooks/the appendix with the corresponding computational details.
\newcommand{\resultsection}[3] {
\pagebreak[3]
\begin{minipage}{0.87\textwidth}
\section{#1}
\end{minipage}
\begin{minipage}{0.12\textwidth}
\textcolor{white}{\rule{1em}{0.1em}}
\href{#2}{\includegraphics[width=3em]{figures/jupyter.png}}
% \qrcode[height=\textwidth]{#2}
\end{minipage}\vspace*{0.5em}
\nopagebreak[4]
}
 
%% Digital version
\newcommand{\resultsubsection}[3] {%
\pagebreak[3]
\begin{minipage}{0.855\textwidth}
\subsection{#1}
\end{minipage}
\ifthenelse{\equal{#2}{}}{%
\begin{minipage}{0.07\textwidth}
\textcolor{white}{\rule{1em}{0.3em}}
\end{minipage}
\begin{minipage}{0.07\textwidth}
\textcolor{white}{\rule{1em}{0.3em}}
\ifthenelse{\equal{#3}{}}{}{%
\hyperref[appendix:sec-#3]{\includegraphics[width=2.5em]{figures/silicon.png}}}
\end{minipage}
}{%
\ifthenelse{\equal{#3}{}}{%
\begin{minipage}{0.07\textwidth}
\textcolor{white}{\rule{1em}{0.3em}}
\end{minipage}
\begin{minipage}{0.07\textwidth}
\textcolor{white}{\rule{1em}{0.3em}}
\href{#2}{\includegraphics[width=3em]{figures/jupyter.png}}
\end{minipage}
}{%
\begin{minipage}{0.07\textwidth}
\textcolor{white}{\rule{1em}{0.3em}}
\href{#2}{\includegraphics[width=3em]{figures/jupyter.png}}
\end{minipage}
\begin{minipage}{0.07\textwidth}
\textcolor{white}{\rule{1em}{0.3em}}
\hyperref[appendix:sec-#3]{\includegraphics[width=2.5em]{figures/silicon.png}}
\end{minipage}
}}
\vspace*{-0.5em}
\nopagebreak[4]
}

%%%%%%%%%%%%%%%%%
% PRINT VERSION % -> Uncomment all code below for print version!
%%%%%%%%%%%%%%%%%

% \renewcommand{\resultsection}[3] {
% \section{#1}
% \begin{wrapfigure}[4]{r}{0.10\textwidth}
% \vspace{-2.4em}
% \qrcode[height=\textwidth]{#2}
% \end{wrapfigure}
% }
% \renewcommand{\resultsubsection}[3] {
% \subsection{#1}
% \begin{wrapfigure}[4]{r}{0.10\textwidth}
% \vspace{-2.4em}
% \qrcode[height=\textwidth]{#2}
% \end{wrapfigure}
% }

% \fancypagestyle{chapter}{
% \fancyhf{}
% \renewcommand{\headrulewidth}{0.4pt}
% \fancyhead[OR]{\textsl{\rightmark}}
% \fancyfoot[OR]{\thepage}
% \fancyhead[EL]{\textsl{\leftmark}}
% \fancyfoot[EL]{\thepage}
% }

% \fancypagestyle{plain}{
% \fancyhf{}
% \renewcommand{\headrulewidth}{0pt}
% \fancyfoot[OR]{\thepage}
% }

% \fancypagestyle{biblio}{
% \fancyhf{}
% \renewcommand{\headrulewidth}{0pt}
% \fancyfoot[OR]{\thepage}
% \fancyfoot[EL]{\thepage}
% }

%%%%%%%
% END %
%%%%%%%

%% Acronyms

\usepackage[toc, nopostdot, acronym, nogroupskip]{glossaries}
\makeglossaries

\newglossaryentry{DFT}{name=DFT,%
  description={Density functional theory}}

\newglossaryentry{SLME}{name=SLME,%
  description={Spectroscopic limited maximum efficiency}}
  
\newglossaryentry{KS}{name=KS,%
  description={Kohn-Sham}}
  
\newglossaryentry{SCF}{name=SCF,%
  description={Self-consistent field}}
  
\newglossaryentry{LDA}{name=LDA,%
  description={Local density approximation}}
  
\newglossaryentry{GGA}{name=GGA,%
  description={Generalised gradient approximation}}
  
\newglossaryentry{PBE}{name=PBE,%
  description={Perdew-Burke-Ernzerhof}}
    
\newglossaryentry{HSE}{name=HSE,%
  description={Heyd-Scuseria-Ernzerhof}}
  
\newglossaryentry{HF}{name=HF,%
  description={Hartree-Fock}}
  
\newglossaryentry{PP}{name=PP,%
  description={Pseudopotential}}
  
\newglossaryentry{PS}{name=PS,%
  description={Pseudo}}
  
\newglossaryentry{AE}{name=AE,%
  description={All-electron}}
  
\newglossaryentry{PAW}{name=PAW,%
  description={Projector augmented wave}}

\newglossaryentry{BZ}{name=BZ,%
  description={Brillouin zone}}
  
\newglossaryentry{IBZ}{name=BZ,%
  description={Irreducible Brillouin zone}}
  
\newglossaryentry{AIMD}{name=AIMD,%
  description={\textit{Ab initio} molecular dynamics}}
  
\newglossaryentry{NEB}{name=NEB,%
  description={Nudged elastic band}}

\newglossaryentry{SQ}{name=SQ,%
  description={Shockley-Queisser}}
  
\newglossaryentry{PV}{name=PV,%
  description={Photovoltaic}}
  
\newglossaryentry{AM}{name=AM,%
  description={Air mass}}

\newglossaryentry{CH}{name=CH,%
  description={Chalcopyrite}}
  
\newglossaryentry{CA}{name=CA,%
  description={CuAu-like}}
  
\newglossaryentry{SRH}{name=SRH,%
  description={Shockley-Read-Hall}}
  
\newglossaryentry{SCAN}{name=SCAN,%
  description={Strongly constrained and appropriately normed}}
  
\newglossaryentry{HAADF}{name=HAADF,%
  description={High-angle annular dark-field}}
  
\newglossaryentry{PXRD}{name=PXRD,%
  description={Powder X-ray diffraction}}
  
\newglossaryentry{EDX}{name=EDX,%
  description={Energy-dispersive X-ray}}
  
\newglossaryentry{NMC}{name=NMC,%
  description={Nickel-Manganese-Cobalt}}
  
\newglossaryentry{PDOS}{name=PDOS,%
  description={Projected density of states}}
  
\newglossaryentry{DOS}{name=DOS,%
  description={Density of states}}

\newglossaryentry{TM}{name=TM,%
  description={transition metal}}

\newglossaryentry{SEE}{name=SEE,%
  description={Secondary electron emission}}

\newglossaryentry{AN}{name=AN,%
  description={Auger neutralization}}

\newglossaryentry{AD}{name=AD,%
  description={Auger De-excitation}}

\newglossaryentry{RN}{name=RN,%
  description={Resonance Neutralization}}

\newglossaryentry{VASP}{name=VASP,%
  description={Vienna ab initio simulation package}}

\newglossaryentry{QUOTAS}{name=QUOTAS,%
  description={quantification of target surfaces}}

% \newglossaryentry{ACRO}{name=,%
%   description={}}

% DFT shortcuts for consistent references and links
\newcommand{\dft}[1]{%
\IfEqCase{#1}{%
{DFT}{Density Functional Theory~\cite{Hohenberg1964, Kohn1965} (DFT)}
{VASP}{\link{appendix:sec-VASP}{Vienna Ab initio Simulation Package}~\cite{Kresse1993, Kresse1996, Kresse1996a} (VASP)}
{PAW}{\link{dft:sec-PAW}{projector augmented wave}~\cite{Blochl1994, Kresse1999} (PAW)}
{GGA}{\link{dft:sec-GGA}{generalized gradient approximation} (GGA)}
{PBE}{Perdew-Burke-Ernzerhof~\cite{Perdew1996} (PBE)}
{PBEU}{\link{dft:sec-dudarev}{PBE+U}~\cite{Dudarev1998, Bengone2000}}
{HSE06}{\link{dft:sec-hybrid}{HSE06}~\cite{Heyd2003}}
{SCAN}{\link{dft:sec-metaGGA}{SCAN}~\cite{Sun2015}}
{MP}{\link{dft:sec-monkhorst}{Monkhorst-Pack}~\cite{Monkhorst1976}}
{plane wave basis}{\link{dft:sec-basis_set}{plane wave basis}}
{NEB}{\link{dft:sec-neb}{nudged elastic band}~\cite{Jonsson1998, Henkelman2000} (NEB)}
{dielectric tensor}{\link{dft:sec-dielectric}{dielectric tensor}~\cite{Gajdos2006, Harl2007}}
{Kramers-Kronig}{\link{dft:eq-kramers}{Kramers-Kronig}}
}}
